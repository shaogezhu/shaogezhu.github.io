---
title: Redis å¸¸è§æ•°æ®ç»“æ„ä»¥åŠä½¿ç”¨åœºæ™¯åˆ†æ
date: 2021/10/11 21:45:48
update: 2021/10/11 21:45:48
categories:
- [Java, å­¦ä¹ ç¬”è®°]
tags:
- Redis
- é¢è¯•

sticky: true
audio:
- https://music.163.com/#/song?id=1901371647

---

:::primary
Redisæ˜¯é¢è¯•ä¸­çš„æœ€ç»å¸¸é—®åˆ°çš„æ•°æ®åº“ä¹‹ä¸€ï¼Œåœ¨æ—¥å¸¸é¡¹ç›®ä¸­æˆ‘ä»¬ä¸ºäº†å¿«é€Ÿè®¿é—®åˆ°ä¸€äº›æ•°æ®ï¼Œé¦–å…ˆæƒ³åˆ°çš„è‚¯å®šå°±æ˜¯Redisäº†ã€‚ä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹Redisçš„åŠŸèƒ½ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä»¥åä½¿ç”¨ğŸ‘©
:::

## Redis å¸¸è§æ•°æ®ç»“æ„ä»¥åŠä½¿ç”¨åœºæ™¯åˆ†æ
**redisæ”¯æŒä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼Œä¸åŒçš„åœºæ™¯ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹å¯ä»¥æœ‰æ•ˆçš„ä¼˜åŒ–å†…å­˜æ•°æ®çš„å­˜æ”¾ç©ºé—´ï¼šğŸŒ´ğŸŒ´**
> 1. **stringï¼š** æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼ŒäºŒè¿›åˆ¶å®‰å…¨çš„å­—ç¬¦ä¸²ï¼Œæœ€å¤§512Mã€‚
> 2. **listï¼š** æŒ‰ç…§æ·»åŠ é¡ºåºä¿æŒé¡ºåºçš„å­—ç¬¦ä¸²åˆ—è¡¨ã€‚
> 3. **hashï¼š** key-valueå¯¹çš„ä¸€ç§é›†åˆã€‚
> 4. **setï¼š** æ— åºçš„å­—ç¬¦ä¸²é›†åˆï¼Œä¸å­˜åœ¨é‡å¤çš„å…ƒç´ ã€‚
> 5. **sorted setï¼š** å·²æ’åºçš„å­—ç¬¦ä¸²é›†åˆã€‚
> 6. **bitmapï¼š** æ›´ç»†åŒ–çš„ä¸€ç§æ“ä½œï¼Œä»¥bitä¸ºå•ä½ã€‚
> 7. **hyperloglogï¼š** åŸºäºæ¦‚ç‡çš„æ•°æ®ç»“æ„ã€‚ # 2.8.9æ–°å¢
> 8. **Geo:**  åœ°ç†ä½ç½®ä¿¡æ¯å‚¨å­˜èµ·æ¥ï¼Œ å¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œæ“ä½œ   # 3.2æ–°å¢
> 9. **æµï¼ˆStreamï¼‰** # 5.0æ–°å¢



<br>

#### String



1. **ä»‹ç» ï¼š** string æ•°æ®ç»“æ„æ˜¯ç®€å•çš„ key-value ç±»å‹ã€‚è™½ç„¶ Redis æ˜¯ç”¨ C è¯­è¨€å†™çš„ï¼Œä½†æ˜¯ Redis å¹¶æ²¡æœ‰ä½¿ç”¨ C çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè€Œæ˜¯è‡ªå·±æ„å»ºäº†ä¸€ç§ **[ç®€å•åŠ¨æ€å­—ç¬¦ä¸²]{.blue}** (simple dynamic stringï¼Œ**SDS**)ã€‚ç›¸æ¯”äº C çš„åŸç”Ÿå­—ç¬¦ä¸²ï¼ŒRedis çš„ SDS ä¸å…‰å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®è¿˜å¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶ä¸”è·å–å­—ç¬¦ä¸²é•¿åº¦å¤æ‚åº¦ä¸º O(1)ï¼ˆC å­—ç¬¦ä¸²ä¸º O(N)ï¼‰,é™¤æ­¤ä¹‹å¤–ï¼ŒRedis çš„ SDS API æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šé€ æˆç¼“å†²åŒºæº¢å‡ºã€‚
2. **å¸¸ç”¨å‘½ä»¤ï¼š** set,get,strlen,exists,decr,incr,setex ç­‰ç­‰ã€‚
3. **åº”ç”¨åœºæ™¯ï¼š** ä¸€èˆ¬å¸¸ç”¨åœ¨éœ€è¦è®¡æ•°çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨æˆ·çš„è®¿é—®æ¬¡æ•°ã€çƒ­ç‚¹æ–‡ç« çš„ç‚¹èµè½¬å‘æ•°é‡ç­‰ç­‰ã€‚



ä¸‹é¢æˆ‘ä»¬ç®€å•çœ‹çœ‹å®ƒçš„ä½¿ç”¨ï¼ğŸ˜
**æ™®é€šå­—ç¬¦ä¸²çš„åŸºæœ¬æ“ä½œï¼š**

~~~shell
127.0.0.1:6379> set key value #è®¾ç½® key-value ç±»å‹çš„å€¼
OK
127.0.0.1:6379> get key # æ ¹æ® key è·å¾—å¯¹åº”çš„ value
"value"
127.0.0.1:6379> exists key  # åˆ¤æ–­æŸä¸ª key æ˜¯å¦å­˜åœ¨
(integer) 1
127.0.0.1:6379> strlen key # è¿”å› key æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦ã€‚
(integer) 5
127.0.0.1:6379> del key # åˆ é™¤æŸä¸ª key å¯¹åº”çš„å€¼
(integer) 1
127.0.0.1:6379> get key
(nil)
~~~
**æ‰¹é‡è®¾ç½® :**
~~~shell
127.0.0.1:6379> mset key1 value1 key2 value2 # æ‰¹é‡è®¾ç½® key-value ç±»å‹çš„å€¼
OK
127.0.0.1:6379> mget key1 key2 # æ‰¹é‡è·å–å¤šä¸ª key å¯¹åº”çš„ value
1) "value1"
2) "value2"
~~~
**è®¡æ•°å™¨ï¼ˆå­—ç¬¦ä¸²çš„å†…å®¹ä¸ºæ•´æ•°çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼‰ï¼š**
~~~shell
127.0.0.1:6379> set number 1
OK
127.0.0.1:6379> incr number # å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢ä¸€
(integer) 2
127.0.0.1:6379> get number
"2"
127.0.0.1:6379> decr number # å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡ä¸€
(integer) 1
127.0.0.1:6379> get number
"1"
~~~
**è¿‡æœŸï¼ˆé»˜è®¤ä¸ºæ°¸ä¸è¿‡æœŸï¼‰ï¼š**
~~~shell
127.0.0.1:6379> expire key  60 # æ•°æ®åœ¨ 60s åè¿‡æœŸ
(integer) 1
127.0.0.1:6379> setex key 60 value # æ•°æ®åœ¨ 60s åè¿‡æœŸ (setex:[set] + [ex]pire)
OK
127.0.0.1:6379> ttl key # æŸ¥çœ‹æ•°æ®è¿˜æœ‰å¤šä¹…è¿‡æœŸ
(integer) 56
~~~

<br>



#### List



1. **ä»‹ç» ï¼š** list å³æ˜¯ **é“¾è¡¨**ã€‚é“¾è¡¨æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„æ•°æ®ç»“æ„ï¼Œç‰¹ç‚¹æ˜¯æ˜“äºæ•°æ®å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤å¹¶ä¸”å¯ä»¥çµæ´»è°ƒæ•´é“¾è¡¨é•¿åº¦ï¼Œä½†æ˜¯é“¾è¡¨çš„éšæœºè®¿é—®å›°éš¾ã€‚è®¸å¤šé«˜çº§ç¼–ç¨‹è¯­è¨€éƒ½å†…ç½®äº†é“¾è¡¨çš„å®ç°æ¯”å¦‚ Java ä¸­çš„ LinkedListï¼Œä½†æ˜¯ C è¯­è¨€å¹¶æ²¡æœ‰å®ç°é“¾è¡¨ï¼Œæ‰€ä»¥ Redis å®ç°äº†è‡ªå·±çš„é“¾è¡¨æ•°æ®ç»“æ„ã€‚Redis çš„ list çš„å®ç°ä¸ºä¸€ä¸ª **[åŒå‘é“¾è¡¨]{.orange}**ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ï¼Œæ›´æ–¹ä¾¿æ“ä½œï¼Œä¸è¿‡å¸¦æ¥äº†éƒ¨åˆ†é¢å¤–çš„å†…å­˜å¼€é”€ã€‚
2. **å¸¸ç”¨å‘½ä»¤:** rpush,lpop,lpush,rpop,lrange,llen ç­‰ã€‚
3. **åº”ç”¨åœºæ™¯:** å‘å¸ƒä¸è®¢é˜…æˆ–è€…è¯´æ¶ˆæ¯é˜Ÿåˆ—ã€æ…¢æŸ¥è¯¢ã€‚



ä¸‹é¢æˆ‘ä»¬ç®€å•çœ‹çœ‹å®ƒçš„ä½¿ç”¨ï¼ğŸ¬

**é€šè¿‡ rpush/lpop å®ç°é˜Ÿåˆ—ï¼š**

~~~shell
127.0.0.1:6379> rpush myList value1 # å‘ list çš„å¤´éƒ¨ï¼ˆå³è¾¹ï¼‰æ·»åŠ å…ƒç´ 
(integer) 1
127.0.0.1:6379> rpush myList value2 value3 # å‘listçš„å¤´éƒ¨ï¼ˆæœ€å³è¾¹ï¼‰æ·»åŠ å¤šä¸ªå…ƒç´ 
(integer) 3
127.0.0.1:6379> lpop myList # å°† listçš„å°¾éƒ¨(æœ€å·¦è¾¹)å…ƒç´ å–å‡º
"value1"
127.0.0.1:6379> lrange myList 0 1 # æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡çš„liståˆ—è¡¨ï¼Œ 0 ä¸º start,1ä¸º end
1) "value2"
2) "value3"
127.0.0.1:6379> lrange myList 0 -1 # æŸ¥çœ‹åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œ-1è¡¨ç¤ºå€’æ•°ç¬¬ä¸€
1) "value2"
2) "value3"
~~~

**é€šè¿‡ rpush/rpop å®ç°æ ˆï¼š**
~~~shell
127.0.0.1:6379> rpush myList2 value1 value2 value3
(integer) 3
127.0.0.1:6379> rpop myList2 # å°† listçš„å¤´éƒ¨(æœ€å³è¾¹)å…ƒç´ å–å‡º
"value3"
~~~
ä¸‹è¾¹å›¾æ–¹ä¾¿å¤§å®¶ç†è§£ï¼š
![image.png](/assets/2021-10/r1.png)

**é€šè¿‡ lrange æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡èŒƒå›´çš„åˆ—è¡¨å…ƒç´ ï¼š**
~~~shell
127.0.0.1:6379> rpush myList value1 value2 value3
(integer) 3
127.0.0.1:6379> lrange myList 0 1 # æŸ¥çœ‹å¯¹åº”ä¸‹æ ‡çš„liståˆ—è¡¨ï¼Œ 0 ä¸º start,1ä¸º end
1) "value1"
2) "value2"
127.0.0.1:6379> lrange myList 0 -1 # æŸ¥çœ‹åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œ-1è¡¨ç¤ºå€’æ•°ç¬¬ä¸€
1) "value1"
2) "value2"
3) "value3"
~~~

é€šè¿‡ lrange å‘½ä»¤ï¼Œä½ å¯ä»¥åŸºäº list å®ç°åˆ†é¡µæŸ¥è¯¢ï¼Œæ€§èƒ½éå¸¸é«˜ï¼
**é€šè¿‡ llen æŸ¥çœ‹é“¾è¡¨é•¿åº¦ï¼š**
~~~shell
127.0.0.1:6379> llen myList
(integer) 3
~~~



<br>

#### Hash



1. **ä»‹ç» ï¼š** hash ç±»ä¼¼äº JDK1.8 å‰çš„ HashMapï¼Œå†…éƒ¨å®ç°ä¹Ÿå·®ä¸å¤š(æ•°ç»„ + é“¾è¡¨)ã€‚ä¸è¿‡ï¼ŒRedis çš„ hash åšäº†æ›´å¤šä¼˜åŒ–ã€‚å¦å¤–ï¼Œhash æ˜¯ä¸€ä¸ª string ç±»å‹çš„ field å’Œ value çš„æ˜ å°„è¡¨ï¼Œ**[ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡]{.pink}**ï¼Œåç»­æ“ä½œçš„æ—¶å€™ï¼Œä½ å¯ä»¥ç›´æ¥ä»…ä»…ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå­—æ®µçš„å€¼ã€‚ æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ hash æ•°æ®ç»“æ„æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œå•†å“ä¿¡æ¯ç­‰ç­‰ã€‚
2. **å¸¸ç”¨å‘½ä»¤ï¼š** hset,hmset,hexists,hget,hgetall,hkeys,hvals ç­‰ã€‚
3. **åº”ç”¨åœºæ™¯ï¼š**  ç³»ç»Ÿä¸­å¯¹è±¡æ•°æ®çš„å­˜å‚¨ã€‚



ä¸‹é¢æˆ‘ä»¬ç®€å•çœ‹çœ‹å®ƒçš„ä½¿ç”¨ï¼ğŸˆ

~~~shell
127.0.0.1:6379> hmset userInfoKey name "guide" description "dev" age "24"
OK
127.0.0.1:6379> hexists userInfoKey name # æŸ¥çœ‹ key å¯¹åº”çš„ valueä¸­æŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨ã€‚
(integer) 1
127.0.0.1:6379> hget userInfoKey name # è·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µçš„å€¼ã€‚
"guide"
127.0.0.1:6379> hget userInfoKey age
"24"
127.0.0.1:6379> hgetall userInfoKey # è·å–åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®š key çš„æ‰€æœ‰å­—æ®µå’Œå€¼
1) "name"
2) "guide"
3) "description"
4) "dev"
5) "age"
6) "24"
127.0.0.1:6379> hkeys userInfoKey # è·å– key åˆ—è¡¨
1) "name"
2) "description"
3) "age"
127.0.0.1:6379> hvals userInfoKey # è·å– value åˆ—è¡¨
1) "guide"
2) "dev"
3) "24"
127.0.0.1:6379> hset userInfoKey name "GuideGeGe" # ä¿®æ”¹æŸä¸ªå­—æ®µå¯¹åº”çš„å€¼
127.0.0.1:6379> hget userInfoKey name
"GuideGeGe"
~~~



<br>

#### Set



1. **ä»‹ç» ï¼š** set ç±»ä¼¼äº Java ä¸­çš„ HashSet ã€‚Redis ä¸­çš„ set ç±»å‹æ˜¯ä¸€ç§æ— åºé›†åˆï¼Œé›†åˆä¸­çš„å…ƒç´ æ²¡æœ‰å…ˆåé¡ºåºã€‚å½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œset æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸” set æä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ª set é›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ list æ‰€ä¸èƒ½æä¾›çš„ã€‚å¯ä»¥åŸºäº set è½»æ˜“å®ç°äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„æ“ä½œã€‚æ¯”å¦‚ï¼šä½ å¯ä»¥å°†ä¸€ä¸ªç”¨æˆ·æ‰€æœ‰çš„å…³æ³¨äººå­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œå°†å…¶æ‰€æœ‰ç²‰ä¸å­˜åœ¨ä¸€ä¸ªé›†åˆã€‚Redis å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°å¦‚å…±åŒå…³æ³¨ã€å…±åŒç²‰ä¸ã€å…±åŒå–œå¥½ç­‰åŠŸèƒ½ã€‚è¿™ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯æ±‚äº¤é›†çš„è¿‡ç¨‹ã€‚
2. **å¸¸ç”¨å‘½ä»¤ï¼š** sadd,spop,smembers,sismember,scard,sinterstore,sunion ç­‰ã€‚
3. **åº”ç”¨åœºæ™¯:** éœ€è¦å­˜æ”¾çš„æ•°æ®ä¸èƒ½é‡å¤ä»¥åŠéœ€è¦è·å–å¤šä¸ªæ•°æ®æºäº¤é›†å’Œå¹¶é›†ç­‰åœºæ™¯



ä¸‹é¢æˆ‘ä»¬ç®€å•çœ‹çœ‹å®ƒçš„ä½¿ç”¨ï¼ğŸ™‡

~~~shell
127.0.0.1:6379> sadd mySet value1 value2 # æ·»åŠ å…ƒç´ è¿›å»
(integer) 2
127.0.0.1:6379> sadd mySet value1 # ä¸å…è®¸æœ‰é‡å¤å…ƒç´ 
(integer) 0
127.0.0.1:6379> smembers mySet # æŸ¥çœ‹ set ä¸­æ‰€æœ‰çš„å…ƒç´ 
1) "value1"
2) "value2"
127.0.0.1:6379> scard mySet # æŸ¥çœ‹ set çš„é•¿åº¦
(integer) 2
127.0.0.1:6379> sismember mySet value1 # æ£€æŸ¥æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨set ä¸­ï¼Œåªèƒ½æ¥æ”¶å•ä¸ªå…ƒç´ 
(integer) 1
127.0.0.1:6379> sadd mySet2 value2 value3
(integer) 2
127.0.0.1:6379> sinterstore mySet3 mySet mySet2 # è·å– mySet å’Œ mySet2 çš„äº¤é›†å¹¶å­˜æ”¾åœ¨ mySet3 ä¸­
(integer) 1
127.0.0.1:6379> smembers mySet3
1) "value2"
~~~

<br>



#### Sorted set



1. **ä»‹ç»ï¼š** å’Œ set ç›¸æ¯”ï¼Œsorted set å¢åŠ äº†ä¸€ä¸ªæƒé‡å‚æ•° scoreï¼Œä½¿å¾—é›†åˆä¸­çš„å…ƒç´ èƒ½å¤ŸæŒ‰ score è¿›è¡Œæœ‰åºæ’åˆ—ï¼Œè¿˜å¯ä»¥é€šè¿‡ score çš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚æœ‰ç‚¹åƒæ˜¯ Java ä¸­ HashMap å’Œ TreeSet çš„ç»“åˆä½“ã€‚
2. **å¸¸ç”¨å‘½ä»¤ï¼š** zadd,zcard,zscore,zrange,zrevrange,zrem ç­‰ã€‚
3. **åº”ç”¨åœºæ™¯ï¼š** éœ€è¦å¯¹æ•°æ®æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„åœºæ™¯ã€‚æ¯”å¦‚åœ¨ç›´æ’­ç³»ç»Ÿä¸­ï¼Œå®æ—¶æ’è¡Œä¿¡æ¯åŒ…å«ç›´æ’­é—´åœ¨çº¿ç”¨æˆ·åˆ—è¡¨ï¼Œå„ç§ç¤¼ç‰©æ’è¡Œæ¦œï¼Œå¼¹å¹•æ¶ˆæ¯ï¼ˆå¯ä»¥ç†è§£ä¸ºæŒ‰æ¶ˆæ¯ç»´åº¦çš„æ¶ˆæ¯æ’è¡Œæ¦œï¼‰ç­‰ä¿¡æ¯ã€‚

å¸¸ç”¨å‘½ä»¤å±•ç¤ºï¼šğŸ‹
~~~shell
127.0.0.1:6379> zadd myZset 3.0 value1 # æ·»åŠ å…ƒç´ åˆ° sorted set ä¸­ 3.0 ä¸ºæƒé‡
(integer) 1
127.0.0.1:6379> zadd myZset 2.0 value2 1.0 value3 # ä¸€æ¬¡æ·»åŠ å¤šä¸ªå…ƒç´ 
(integer) 2
127.0.0.1:6379> zcard myZset # æŸ¥çœ‹ sorted set ä¸­çš„å…ƒç´ æ•°é‡
(integer) 3
127.0.0.1:6379> zscore myZset value1 # æŸ¥çœ‹æŸä¸ª value çš„æƒé‡
"3"
127.0.0.1:6379> zrange  myZset 0 -1 # é¡ºåºè¾“å‡ºæŸä¸ªèŒƒå›´åŒºé—´çš„å…ƒç´ ï¼Œ0 -1 è¡¨ç¤ºè¾“å‡ºæ‰€æœ‰å…ƒç´ 
1) "value3"
2) "value2"
3) "value1"
127.0.0.1:6379> zrange  myZset 0 1 # é¡ºåºè¾“å‡ºæŸä¸ªèŒƒå›´åŒºé—´çš„å…ƒç´ ï¼Œ0 ä¸º start  1 ä¸º stop
1) "value3"
2) "value2"
127.0.0.1:6379> zrevrange  myZset 0 1 # é€†åºè¾“å‡ºæŸä¸ªèŒƒå›´åŒºé—´çš„å…ƒç´ ï¼Œ0 ä¸º start  1 ä¸º stop
1) "value1"
2) "value2"
~~~

<br>

#### Bitmap ä½å›¾



1. **ä»‹ç»ï¼š**  bitmap å­˜å‚¨çš„æ˜¯è¿ç»­çš„äºŒè¿›åˆ¶æ•°å­—ï¼ˆ0 å’Œ 1ï¼‰ï¼Œé€šè¿‡ bitmap, åªéœ€è¦ä¸€ä¸ª bit ä½æ¥è¡¨ç¤ºæŸä¸ªå…ƒç´ å¯¹åº”çš„å€¼æˆ–è€…çŠ¶æ€ï¼Œkey å°±æ˜¯å¯¹åº”å…ƒç´ æœ¬èº« ã€‚æˆ‘ä»¬çŸ¥é“ 8 ä¸ª bit å¯ä»¥ç»„æˆä¸€ä¸ª byteï¼Œæ‰€ä»¥ bitmap æœ¬èº«ä¼šæå¤§çš„èŠ‚çœå‚¨å­˜ç©ºé—´ã€‚
2. **å¸¸ç”¨å‘½ä»¤ï¼š**  setbit ã€getbit ã€bitcountã€bitop
3. **åº”ç”¨åœºæ™¯ï¼š**  é€‚åˆéœ€è¦ä¿å­˜çŠ¶æ€ä¿¡æ¯ï¼ˆæ¯”å¦‚æ˜¯å¦ç­¾åˆ°ã€æ˜¯å¦ç™»å½•...ï¼‰å¹¶éœ€è¦è¿›ä¸€æ­¥å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œåˆ†æçš„åœºæ™¯ã€‚æ¯”å¦‚ç”¨æˆ·ç­¾åˆ°æƒ…å†µã€æ´»è·ƒç”¨æˆ·æƒ…å†µã€ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ï¼ˆæ¯”å¦‚æ˜¯å¦ç‚¹èµè¿‡æŸä¸ªè§†é¢‘ï¼‰ã€‚


~~~shell
# SETBIT ä¼šè¿”å›ä¹‹å‰ä½çš„å€¼ï¼ˆé»˜è®¤æ˜¯ 0ï¼‰è¿™é‡Œä¼šç”Ÿæˆ 7 ä¸ªä½
127.0.0.1:6379> setbit mykey 7 1
(integer) 0
127.0.0.1:6379> setbit mykey 7 0
(integer) 1
127.0.0.1:6379> getbit mykey 7
(integer) 0
127.0.0.1:6379> setbit mykey 6 1
(integer) 0
127.0.0.1:6379> setbit mykey 8 1
(integer) 0
# é€šè¿‡ bitcount ç»Ÿè®¡è¢«è¢«è®¾ç½®ä¸º 1 çš„ä½çš„æ•°é‡ã€‚
127.0.0.1:6379> bitcount mykey
(integer) 2
~~~

é’ˆå¯¹ä¸Šé¢æåˆ°çš„ä¸€äº›åœºæ™¯ï¼Œè¿™é‡Œè¿›è¡Œè¿›ä¸€æ­¥è¯´æ˜ã€‚



**ä½¿ç”¨åœºæ™¯ä¸€ğŸ“ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æ** å¾ˆå¤šç½‘ç«™ä¸ºäº†åˆ†æä½ çš„å–œå¥½ï¼Œéœ€è¦ç ”ç©¶ä½ ç‚¹èµè¿‡çš„å†…å®¹ã€‚
~~~shell
# è®°å½•ä½ å–œæ¬¢è¿‡ 001 å·å°å§å§
127.0.0.1:6379> setbit beauty_girl_001 uid 1
~~~


**ä½¿ç”¨åœºæ™¯äºŒğŸ“ï¼šç»Ÿè®¡æ´»è·ƒç”¨æˆ·**

ä½¿ç”¨æ—¶é—´ä½œä¸º keyï¼Œç„¶åç”¨æˆ· ID ä¸º offsetï¼Œå¦‚æœå½“æ—¥æ´»è·ƒè¿‡å°±è®¾ç½®ä¸º 1



é‚£ä¹ˆæˆ‘è¯¥å¦‚ä½•è®¡ç®—æŸå‡ å¤©/æœˆ/å¹´çš„æ´»è·ƒç”¨æˆ·å‘¢(æš‚ä¸”çº¦å®šï¼Œç»Ÿè®¡æ—¶é—´å†…åªè¦æœ‰ä¸€å¤©åœ¨çº¿å°±ç§°ä¸ºæ´»è·ƒ)ï¼Œæœ‰è¯·ä¸‹ä¸€ä¸ª redis çš„å‘½ä»¤
~~~shell
# å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªä¿å­˜äºŒè¿›åˆ¶ä½çš„å­—ç¬¦ä¸² key è¿›è¡Œä½å…ƒæ“ä½œï¼Œå¹¶å°†ç»“æœä¿å­˜åˆ° destkey ä¸Šã€‚
# BITOP å‘½ä»¤æ”¯æŒ AND ã€ OR ã€ NOT ã€ XOR è¿™å››ç§æ“ä½œä¸­çš„ä»»æ„ä¸€ç§å‚æ•°
BITOP operation destkey key [key ...]
~~~
åˆå§‹åŒ–æ•°æ®ï¼š
~~~shell
127.0.0.1:6379> setbit 20210308 1 1
(integer) 0
127.0.0.1:6379> setbit 20210308 2 1
(integer) 0
127.0.0.1:6379> setbit 20210309 1 1
(integer) 0
~~~
ç»Ÿè®¡ 20210308~20210309 æ€»æ´»è·ƒç”¨æˆ·æ•°: 1
~~~shell
127.0.0.1:6379> bitop and desk1 20210308 20210309
(integer) 1
127.0.0.1:6379> bitcount desk1
(integer) 1	
~~~
ç»Ÿè®¡ 20210308~20210309 åœ¨çº¿æ´»è·ƒç”¨æˆ·æ•°: 2
~~~shell
127.0.0.1:6379> bitop or desk2 20210308 20210309
(integer) 1
127.0.0.1:6379> bitcount desk2
(integer) 2
~~~
**ä½¿ç”¨åœºæ™¯ä¸‰ğŸ“ï¼šç”¨æˆ·åœ¨çº¿çŠ¶æ€**

å¯¹äºè·å–æˆ–è€…ç»Ÿè®¡ç”¨æˆ·åœ¨çº¿çŠ¶æ€ï¼Œä½¿ç”¨ bitmap æ˜¯ä¸€ä¸ªèŠ‚çº¦ç©ºé—´ä¸”æ•ˆç‡åˆé«˜çš„ä¸€ç§æ–¹æ³•ã€‚

åªéœ€è¦ä¸€ä¸ª keyï¼Œç„¶åç”¨æˆ· ID ä¸º offsetï¼Œå¦‚æœåœ¨çº¿å°±è®¾ç½®ä¸º 1ï¼Œä¸åœ¨çº¿å°±è®¾ç½®ä¸º 0ã€‚



<br>

#### HyperLogLog åŸºæ•°ç»Ÿè®¡

**Redis çš„åŸºæ•°ç»Ÿè®¡**ï¼Œè¿™ä¸ªç»“æ„å¯ä»¥éå¸¸çœå†…å­˜çš„å»ç»Ÿè®¡å„ç§è®¡æ•°ï¼Œæ¯”å¦‚æ³¨å†Œ IP æ•°ã€æ¯æ—¥è®¿é—® IP æ•°ã€é¡µé¢å®æ—¶UVï¼‰ã€åœ¨çº¿ç”¨æˆ·æ•°ç­‰ã€‚ä½†æ˜¯å®ƒä¹Ÿæœ‰å±€é™æ€§ï¼Œå°±æ˜¯åªèƒ½ç»Ÿè®¡æ•°é‡ï¼Œè€Œæ²¡åŠæ³•å»çŸ¥é“å…·ä½“çš„å†…å®¹æ˜¯ä»€ä¹ˆã€‚

>å½“ç„¶ç”¨é›†åˆä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯ä¸€ä¸ªå¤§å‹çš„ç½‘ç«™ï¼Œæ¯å¤© IP æ¯”å¦‚æœ‰ 100 ä¸‡ï¼Œç²—ç®—ä¸€ä¸ª IP æ¶ˆè€— 15 å­—èŠ‚ï¼Œé‚£ä¹ˆ 100 ä¸‡ä¸ª IP å°±æ˜¯ 15Mã€‚è€Œ HyperLogLog åœ¨ Redis ä¸­æ¯ä¸ªé”®å ç”¨çš„å†…å®¹éƒ½æ˜¯ 12Kï¼Œç†è®ºå­˜å‚¨è¿‘ä¼¼æ¥è¿‘ 2^64 ä¸ªå€¼ï¼Œä¸ç®¡å­˜å‚¨çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Œå®ƒä¸€ä¸ªåŸºäºåŸºæ•°ä¼°ç®—çš„ç®—æ³•ï¼Œåªèƒ½æ¯”è¾ƒå‡†ç¡®çš„ä¼°ç®—å‡ºåŸºæ•°ï¼Œå¯ä»¥ä½¿ç”¨å°‘é‡å›ºå®šçš„å†…å­˜å»å­˜å‚¨å¹¶è¯†åˆ«é›†åˆä¸­çš„å”¯ä¸€å…ƒç´ ã€‚è€Œä¸”è¿™ä¸ªä¼°ç®—çš„åŸºæ•°å¹¶ä¸ä¸€å®šå‡†ç¡®ï¼Œæ˜¯ä¸€ä¸ªå¸¦æœ‰ 0.81% æ ‡å‡†é”™è¯¯çš„è¿‘ä¼¼å€¼ã€‚



**åº”ç”¨åœºæ™¯:âœ¨**
HyperLogLog ä¸»è¦çš„åº”ç”¨åœºæ™¯å°±æ˜¯è¿›è¡ŒåŸºæ•°ç»Ÿè®¡ã€‚è¿™ä¸ªé—®é¢˜çš„åº”ç”¨åœºæ™¯å…¶å®æ˜¯ååˆ†å¹¿æ³›çš„ã€‚ä¾‹å¦‚ï¼šå¯¹äº Google ä¸»é¡µé¢è€Œè¨€ï¼ŒåŒä¸€ä¸ªè´¦æˆ·å¯èƒ½ä¼šè®¿é—® Google ä¸»é¡µé¢å¤šæ¬¡ã€‚äºæ˜¯ï¼Œåœ¨è¯¸å¤šçš„è®¿é—®æµæ°´ä¸­ï¼Œå¦‚ä½•è®¡ç®—å‡º Google ä¸»é¡µé¢æ¯å¤©è¢«å¤šå°‘ä¸ªä¸åŒçš„è´¦æˆ·è®¿é—®è¿‡å°±æ˜¯ä¸€ä¸ªé‡è¦çš„é—®é¢˜ã€‚é‚£ä¹ˆå¯¹äº Google è¿™ç§è®¿é—®é‡å·¨å¤§çš„ç½‘é¡µè€Œè¨€ï¼Œå…¶å®ç»Ÿè®¡å‡ºæœ‰åäº¿ çš„è®¿é—®é‡æˆ–è€…åäº¿é›¶åä¸‡çš„è®¿é—®é‡å…¶å®æ˜¯æ²¡æœ‰å¤ªå¤šçš„åŒºåˆ«çš„ï¼Œå› æ­¤ï¼Œåœ¨è¿™ç§ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œä¸ºäº†èŠ‚çœæˆæœ¬ï¼Œå…¶å®å¯ä»¥åªè®¡ç®—å‡ºä¸€ä¸ªå¤§æ¦‚çš„å€¼ï¼Œè€Œæ²¡æœ‰å¿…è¦è®¡ç®—å‡ºç²¾å‡†çš„å€¼ã€‚

è¿™ä¸ªæ•°æ®ç»“æ„çš„å‘½ä»¤æœ‰ä¸‰ä¸ªï¼šPFADDã€PFCOUNTã€PFMERGE
~~~shell
redis> PFADD databases "Redis" "MongoDB" "MySQL"
(integer) 1
 
redis> PFADD databases "Redis"  # Redis å·²ç»å­˜åœ¨ï¼Œä¸å¿…å¯¹ä¼°è®¡æ•°é‡è¿›è¡Œæ›´æ–°
(integer) 0
 
redis> PFCOUNT databases
(integer) 3
~~~

<br>



#### Geo åœ°ç†ä½ç½®

Redis çš„ GEO ç‰¹æ€§åœ¨ Redis 3.2 ç‰ˆæœ¬ä¸­æ¨å‡ºï¼Œ è¿™ä¸ªåŠŸèƒ½å¯ä»¥å°†ç”¨æˆ·ç»™å®šçš„åœ°ç†ä½ç½®ä¿¡æ¯å‚¨å­˜èµ·æ¥ï¼Œ å¹¶å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚GEOçš„æ•°æ®ç»“æ„æ€»å…±æœ‰å…­ä¸ªå‘½ä»¤ï¼šgeoaddã€geoposã€geodistã€georadiusã€georadiusbymemberã€gethash,**GEOä½¿ç”¨çš„æ˜¯å›½é™…é€šç”¨åæ ‡ç³»WGS-84ã€‚**



å¸¸ç”¨æŒ‡ä»¤ï¼š
>1. GEOADD: æ·»åŠ åœ°ç†ä½ç½®
>2. GEOPOSï¼šæŸ¥è¯¢åœ°ç†ä½ç½®ï¼ˆç»çº¬åº¦ï¼‰ï¼Œè¿”å›æ•°ç»„
>3. GEODISTï¼šè®¡ç®—ä¸¤ä½ä½ç½®é—´çš„è·ç¦»
>4. GEORADIUSï¼šä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œ è¿”å›é”®åŒ…å«çš„ä½ç½®å…ƒç´ å½“ä¸­ï¼Œ ä¸ä¸­å¿ƒçš„è·ç¦»ä¸è¶…è¿‡ç»™å®šæœ€å¤§è·ç¦»çš„æ‰€æœ‰ä½ç½®å…ƒç´ ã€‚
>5. GEORADIUSBYMEMBERï¼šä»¥ç»™å®šçš„åœ°ç†ä½ç½®ä¸ºä¸­å¿ƒï¼Œ è¿”å›é”®åŒ…å«çš„ä½ç½®å…ƒç´ å½“ä¸­ï¼Œ ä¸ä¸­å¿ƒçš„è·ç¦»ä¸è¶…è¿‡ç»™å®šæœ€å¤§è·ç¦»çš„æ‰€æœ‰ä½ç½®å…ƒç´ ã€‚

~~~shell
127.0.0.1:6379> geoadd kcityGeo 116.405285 39.904989 "beijing"
(integer) 1
127.0.0.1:6379> geoadd kcityGeo 121.472644 31.231706 "shanghai"
(integer) 1 
127.0.0.1:6379> geodist kcityGeo beijing shanghai km
"1067.5980"
127.0.0.1:6379> geopos kcityGeo beijing
1) 1) "116.40528291463851929"
   2) "39.9049884229125027"
127.0.0.1:6379> geohash kcityGeo beijing
1) "wx4g0b7xrt0"
127.0.0.1:6379> georadiusbymember kcityGeo beijing 1200 km withdist withcoord asc count 5
1) 1) "beijing"
   2) "0.0000"
   3) 1) "116.40528291463851929"
      2) "39.9049884229125027"
2) 1) "shanghai"
   2) "1067.5980"
   3) 1) "121.47264629602432251"
      2) "31.23170490709807012"
~~~



<br>

#### Streams æµ

**æ”¯æŒå¤šæ’­çš„å¯æŒä¹…åŒ–çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºå®ç°å‘å¸ƒè®¢é˜…åŠŸèƒ½**ï¼Œå€Ÿé‰´äº† kafka çš„è®¾è®¡ã€‚Redis Streamçš„ç»“æ„æœ‰ä¸€ä¸ªæ¶ˆæ¯é“¾è¡¨ï¼Œå°†æ‰€æœ‰åŠ å…¥çš„æ¶ˆæ¯éƒ½ä¸²èµ·æ¥ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDå’Œå¯¹åº”çš„å†…å®¹ã€‚æ¶ˆæ¯æ˜¯æŒä¹…åŒ–çš„ï¼ŒRedisé‡å¯åï¼Œå†…å®¹è¿˜åœ¨ã€‚ğŸš€ğŸš€ğŸš€

![image.png](/assets/2021-10/r2.png)

æ¯ä¸ªStreaméƒ½æœ‰å”¯ä¸€çš„åç§°ï¼Œå®ƒå°±æ˜¯Redisçš„keyï¼Œåœ¨æˆ‘ä»¬é¦–æ¬¡ä½¿ç”¨xaddæŒ‡ä»¤è¿½åŠ æ¶ˆæ¯æ—¶è‡ªåŠ¨åˆ›å»ºã€‚

>æ¯ä¸ª**Stream**éƒ½å¯ä»¥æŒ‚å¤šä¸ªæ¶ˆè´¹ç»„ï¼Œæ¯ä¸ªæ¶ˆè´¹ç»„ä¼šæœ‰ä¸ªæ¸¸æ ‡last_delivered_idåœ¨Streamæ•°ç»„ä¹‹ä¸Šå¾€å‰ç§»åŠ¨ï¼Œè¡¨ç¤ºå½“å‰æ¶ˆè´¹ç»„å·²ç»æ¶ˆè´¹åˆ°å“ªæ¡æ¶ˆæ¯äº†ã€‚æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½æœ‰ä¸€ä¸ªStreamå†…å”¯ä¸€çš„åç§°ï¼Œæ¶ˆè´¹ç»„ä¸ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå®ƒéœ€è¦å•ç‹¬çš„æŒ‡ä»¤xgroup createè¿›è¡Œåˆ›å»ºï¼Œéœ€è¦æŒ‡å®šä»Streamçš„æŸä¸ªæ¶ˆæ¯IDå¼€å§‹æ¶ˆè´¹ï¼Œè¿™ä¸ªIDç”¨æ¥åˆå§‹åŒ–last_delivered_idå˜é‡ã€‚
>
>æ¯ä¸ª**æ¶ˆè´¹ç»„**(Consumer Group)çš„çŠ¶æ€éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œç›¸äº’ä¸å—å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´åŒä¸€ä»½Streamå†…éƒ¨çš„æ¶ˆæ¯ä¼šè¢«æ¯ä¸ªæ¶ˆè´¹ç»„éƒ½æ¶ˆè´¹åˆ°ã€‚
>
>åŒä¸€ä¸ªæ¶ˆè´¹ç»„(Consumer Group)å¯ä»¥æŒ‚æ¥å¤šä¸ªæ¶ˆè´¹è€…(Consumer)ï¼Œè¿™äº›æ¶ˆè´¹è€…ä¹‹é—´æ˜¯ç«äº‰å…³ç³»ï¼Œä»»æ„ä¸€ä¸ªæ¶ˆè´¹è€…è¯»å–äº†æ¶ˆæ¯éƒ½ä¼šä½¿æ¸¸æ ‡last_delivered_idå¾€å‰ç§»åŠ¨ã€‚æ¯ä¸ªæ¶ˆè´¹è€…è€…æœ‰ä¸€ä¸ªç»„å†…å”¯ä¸€åç§°ã€‚
>
>**æ¶ˆè´¹è€…**(Consumer)å†…éƒ¨ä¼šæœ‰ä¸ªçŠ¶æ€å˜é‡pending_idsï¼Œå®ƒè®°å½•äº†å½“å‰å·²ç»è¢«å®¢æˆ·ç«¯è¯»å–çš„æ¶ˆæ¯ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰ackã€‚å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰ackï¼Œè¿™ä¸ªå˜é‡é‡Œé¢çš„æ¶ˆæ¯IDä¼šè¶Šæ¥è¶Šå¤šï¼Œä¸€æ—¦æŸä¸ªæ¶ˆæ¯è¢«ackï¼Œå®ƒå°±å¼€å§‹å‡å°‘ã€‚è¿™ä¸ªpending_idså˜é‡åœ¨Rediså®˜æ–¹è¢«ç§°ä¹‹ä¸ºPELï¼Œä¹Ÿå°±æ˜¯Pending Entries Listï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæ ¸å¿ƒçš„æ•°æ®ç»“æ„ï¼Œå®ƒç”¨æ¥ç¡®ä¿å®¢æˆ·ç«¯è‡³å°‘æ¶ˆè´¹äº†æ¶ˆæ¯ä¸€æ¬¡ï¼Œè€Œä¸ä¼šåœ¨ç½‘ç»œä¼ è¾“çš„ä¸­é€”ä¸¢å¤±äº†æ²¡å¤„ç†ã€‚
>
>**æ¶ˆæ¯IDï¼š** æ¶ˆæ¯IDçš„å½¢å¼æ˜¯timestampInMillis-sequenceï¼Œä¾‹å¦‚1527846880572-5ï¼Œå®ƒè¡¨ç¤ºå½“å‰çš„æ¶ˆæ¯åœ¨æ¯«ç±³æ—¶é—´æˆ³1527846880572æ—¶äº§ç”Ÿï¼Œå¹¶ä¸”æ˜¯è¯¥æ¯«ç§’å†…äº§ç”Ÿçš„ç¬¬5æ¡æ¶ˆæ¯ã€‚æ¶ˆæ¯IDå¯ä»¥ç”±æœåŠ¡å™¨è‡ªåŠ¨ç”Ÿæˆï¼Œä¹Ÿå¯ä»¥ç”±å®¢æˆ·ç«¯è‡ªå·±æŒ‡å®šï¼Œä½†æ˜¯å½¢å¼å¿…é¡»æ˜¯æ•´æ•°-æ•´æ•°ï¼Œè€Œä¸”å¿…é¡»æ˜¯åé¢åŠ å…¥çš„æ¶ˆæ¯çš„IDè¦å¤§äºå‰é¢çš„æ¶ˆæ¯IDã€‚
>
>**æ¶ˆæ¯å†…å®¹ï¼š** æ¶ˆæ¯å†…å®¹å°±æ˜¯é”®å€¼å¯¹ï¼Œå½¢å¦‚hashç»“æ„çš„é”®å€¼å¯¹ï¼Œè¿™æ²¡ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ã€‚

~~~shell
127.0.0.1:6379> XADD mystream * field1 value1 field2 value2 field3 value3
"1588491680862-0"
127.0.0.1:6379> XADD mystream * username lisi age 18
"1588491854070-0"
127.0.0.1:6379> xlen mystream
(integer) 2
127.0.0.1:6379> XADD mystream * username lisi age 18
"1588491861215-0"
127.0.0.1:6379> xrange mystream - + 
1) 1) "1588491680862-0"
   2) 1) "field1"
      2) "value1"
      3) "field2"
      4) "value2"
      5) "field3"
      6) "value3"
2) 1) "1588491854070-0"
   2) 1) "username"
      2) "lisi"
      3) "age"
      4) "18"
3) 1) "1588491861215-0"
   2) 1) "username"
      2) "lisi"
      3) "age"
      4) "18"
127.0.0.1:6379> xdel mystream 1588491854070-0 
(integer) 1
127.0.0.1:6379> xrange mystream - + 
1) 1) "1588491680862-0"
   2) 1) "field1"
      2) "value1"
      3) "field2"
      4) "value2"
      5) "field3"
      6) "value3"
2) 1) "1588491861215-0"
   2) 1) "username"
      2) "lisi"
      3) "age"
      4) "18"
127.0.0.1:6379> xlen mystream
(integer) 2
~~~



<br>
